
<p style="text-align:center;" align="center"><a href="https://meshery.io"><picture>
 <source media="(prefers-color-scheme: dark)" srcset="https://raw.githubusercontent.com/meshery/meshery/master/.github/assets/images/readme/meshery-logo-light-text-side.svg">
 <source media="(prefers-color-scheme: light)" srcset="https://raw.githubusercontent.com/meshery/meshery/master/.github/assets/images/readme/meshery-logo-dark-text-side.svg">
<img src="https://raw.githubusercontent.com/meshery/meshery/master/.github/assets/images/readme/meshery-logo-dark-text-side.svg"
alt="Meshery Logo" width="70%" /></picture></a><br /><br /></p>
<p align="center">
<a href="https://hub.docker.com/r/layer5/meshery" alt="Docker pulls">
  <img src="https://img.shields.io/docker/pulls/layer5/meshery.svg" /></a>
<a href="https://github.com/issues?q=is%3Aopen+is%3Aissue+archived%3Afalse+org%3Alayer5io+org%3Ameshery+org%3Aservice-mesh-performance+org%3Aservice-mesh-patterns+org%3A+label%3A%22help+wanted%22+" alt="GitHub issues by-label">
  <img src="https://img.shields.io/github/issues/layer5io/meshery/help%20wanted.svg?color=informational" /></a>
<a href="https://github.com/meshery/meshery/blob/master/LICENSE" alt="LICENSE">
  <img src="https://img.shields.io/github/license/meshery/meshery?color=brightgreen" /></a>
<a href="https://artifacthub.io/packages/helm/meshery/meshery" alt="Artifact Hub Meshery">
  <img src="https://img.shields.io/endpoint?color=brightgreen&label=Helm%20Chart&style=plastic&url=https%3A%2F%2Fartifacthub.io%2Fbadge%2Frepository%2Fartifact-hub" /></a>
<a href="https://goreportcard.com/report/github.com/meshery/meshery" alt="Go Report Card">
  <img src="https://goreportcard.com/badge/github.com/meshery/meshery" /></a>
<a href="https://github.com/meshery/meshery/actions" alt="Build Status">
  <img src="https://img.shields.io/github/actions/workflow/status/meshery/meshery/release-drafter.yml" /></a>
<a href="https://bestpractices.coreinfrastructure.org/projects/3564" alt="CLI Best Practices">
  <img src="https://bestpractices.coreinfrastructure.org/projects/3564/badge" /></a>
<a href="http://discuss.meshery.io" alt="Discuss Users">
  <img src="https://img.shields.io/discourse/users?label=discuss&logo=discourse&server=https%3A%2F%2Fdiscuss.layer5.io" /></a>
<a href="https://slack.meshery.io" alt="Join Slack">
  <img src="https://img.shields.io/badge/Slack-@layer5.svg?logo=slack" /></a>
<a href="https://twitter.com/intent/follow?screen_name=mesheryio" alt="Twitter Follow">
  <img src="https://img.shields.io/twitter/follow/mesheryio.svg?label=Follow+Meshery&style=social" /></a>
<a href="https://github.com/meshery/meshery/releases" alt="Meshery Downloads">
  <img src="https://img.shields.io/github/downloads/meshery/meshery/total" /></a>
<!-- <a href="https://app.fossa.com/projects/git%2Bgithub.com%2Fmeshery%2Fmeshery?ref=badge_shield" alt="License Scan Report">
  <img src="https://app.fossa.com/api/projects/git%2Bgithub.com%2Fmeshery%2Fmeshery.svg?type=shield"/></a>
  -->
</p>

<h5><p align="center"><i>If you‚Äôre using Meshery or if you like the project, please <a href="https://github.com/meshery/meshery/stargazers">‚òÖ</a> this repository to show your support! ü§©</i></p></h5>

# Meshery Schemas

Meshery follows schema-driven development. As a project, Meshery has different types of schemas. Some schemas are external facing, and some internal to Meshery itself. This repository serves as a central location for storing schemas from which all Meshery components can take reference.

Meshery schemas offer a powerful system designed for:

- **Model-Driven Management:** Meshery uses explicit models for describing infrastructure and applications.
- **Dynamic Discovery:** The ability to process different kinds of relationships and styles, enables a sophisticated system that can adapt to many configurations.
- **Lifecycle Management:** The schema properties track status and lifecycle of resources.
- **Extensibility:** Open-ended metadata and modular schema components enable expansion and customization.
- **Visual Representation:** The properties for styling of edges and nodes is for creating a user friendly visual representation.
- **Automated Operations:** The schemas can support validation and automated configuration of infrastructure and applications, and patching.

For an explanation of Meshery's terminology regarding schemas, definitions, declarations, and instances, please see [Contributor's Guide to Models](https://docs.meshery.io/project/contributing/contributing-models).

## Contributing
--> **For an explanation of the directory structure of this repository and how to contribute changes to Meshery's schemas, see [Contributor's Guide to Schema-Driven Development](https://docs.meshery.io/project/contributing/contributing-schemas).**

<p style="clear:both;">&nbsp;</p>

## Join the Meshery community!

<a name="contributing"></a><a name="community"></a>
Our projects are community-built and welcome collaboration. üëç Be sure to see the <a href="https://docs.meshery.io/project/contributing#not-sure-where-to-start">Contributor Welcome Guide</a> and <a href="https://meshery.io/community#handbook">Community Handbook</a> for a tour of resources available to you and the <a href="https://layer5.io/community/handbook/repository-overview">Repository Overview</a> for a cursory description of repository by technology and programming language. Jump into community <a href="https://slack.meshery.io">Slack</a> or <a href="https://meshery.io/community#discussion-forums">discussion forum</a> to participate.

<p style="clear:both;">
<a href ="https://meshery.io/community"><img alt="MeshMates" src=".github/assets/images/readme/layer5-community-sign.png" style="margin-right:36px; margin-bottom:7px;" width="140px" align="left" /></a>
<h3>Find your MeshMate</h3>

<p>MeshMates are experienced community members, who will help you learn your way around, discover live projects, and expand your community network. Connect with a Meshmate today!</p>

Find out more on the <a href="https://meshery.io/community#meshmates">Meshery community</a>. <br />

</p>
<br /><br />
<div style="display: flex; justify-content: center; align-items:center;">
<div>
<a href="https://meshery.io/community"><img alt="Meshery Cloud Native Community" src="https://docs.meshery.io/assets/img/readme/community.png" width="140px" style="margin-right:36px; margin-bottom:7px;" width="140px" align="left"/></a>
</div>
<div style="width:60%; padding-left: 16px; padding-right: 16px">
<p>
‚úîÔ∏è <em><strong>Join</strong></em> any or all of the weekly meetings on <a href="https://meshery.io/calendar">community calendar</a>.<br />
‚úîÔ∏è <em><strong>Watch</strong></em> community <a href="https://www.youtube.com/@mesheryio?sub_confirmation=1">meeting recordings</a>.<br />
‚úîÔ∏è <em><strong>Fill-in</strong></em> a <a href="https://layer5.io/newcomers">community member form</a> to gain access to community resources.
<br />
‚úîÔ∏è <em><strong>Discuss</strong></em> in the <a href="https://meshery.io/community#discussion-forums">Community Forum</a>.<br />
‚úîÔ∏è <em><strong>Explore more</strong></em> in the <a href="https://meshery.io/community#handbook">Community Handbook</a>.<br />
</p>
<p align="center">
<i>Not sure where to start?</i> Grab an open issue with the <a href="https://github.com/issues?q=is%3Aopen+is%3Aissue+archived%3Afalse+org%3Alayer5io+org%3Ameshery+org%3Ameshery-extensions+org%3Aservice-mesh-performance+org%3Aservice-mesh-patterns+label%3A%22help+wanted%22">help-wanted label</a>.
</p>
</div>
<div>&nbsp;</div>

## Contributing

Please do! We're a warm and welcoming community of open source contributors. All types of contributions are welcome. Please read:

- [General Contributor Guide](https://docs.meshery.io/project/contributing) - Overview of contribution processes
- [Schema Contributor Guide](./CONTRIBUTING.md) - Schema-specific development workflows and guidelines

<div>&nbsp;</div>


# üß¨ Schema-Driven Development Guide

Meshery follows a **Schema-Driven Development (SDD)** approach. This means that the **structure of data** used throughout the system is centrally defined using **schemas**. These schemas power consistency, validation, and code generation across the Meshery platform.

---

## üßæ Schema Definition in Meshery

Meshery uses the **OpenAPI v3** specification to define and manage schemas. Given the complexity of the platform, Meshery adopts a **modular, versioned, and extensible** schema strategy:

* ‚úÖ **Versioned schemas** for backward compatibility.
* üß© **Modular constructs** for maintainability and reuse.
* üß™ **Schemas are used** for validation, API documentation, and automatic code generation.

> üí° **TIP**: When referencing models or other constructs in the schema, **always add `x-go-type` and `x-go-import-path`** to avoid generating redundant Go structs. Refer to existing patterns in the codebase.

---

## üìÅ Schema Directory Structure

All schemas are located in the `schemas/` directory at the root of the Meshery repository:

```
schemas/
  constructs/
    <schema-version>/               # e.g., v1beta1
      <construct>/                  # e.g., model, component
        <construct>.json            # Schema definition for the construct (noun)
        subschemas/                 # Reusable modular pieces
        openapi.yml                 # API operations (verbs: create, update, delete)
        <construct>_template.json   # Generated JSON template from schema
        <construct>_template.yaml   # Generated YAML template from schema
```

### üß† Explanation

* **`constructs/`** ‚Äì Holds schemas for various versions.
* **`<schema-version>/`** ‚Äì Represents a version (e.g., `v1alpha2`, `v1beta1`).
* **`<construct>/`** ‚Äì A specific construct like `pattern`, `component`, etc.
* **`<construct>.json`** ‚Äì Defines the **data model (noun)** for the construct.
* **`subschemas/`** ‚Äì Contains shared schema components for reuse.
* **`openapi.yml`** ‚Äì Defines **API operations** (verbs).
* **Templates** ‚Äì `*_template.json` and `*_template.yaml` are auto-generated examples with resolved references and defaults.

---

## ‚öôÔ∏è Code Generation

Meshery supports **automated code generation** from schemas for:

* **Go**: Strongly-typed models for backend.
* **TypeScript**: Interfaces and types for frontend use.
* **RTK Query**: Clients generated from OpenAPI for use with Redux.
* **JSON/YAML**: Templates with defaults and resolved references.

---

## üöÄ Unified Build: One Command for Everything

Use the following command to perform the **entire schema-driven generation workflow**:

```bash
make build
```

### üîß What `make build` does:

1. **Bundles OpenAPI schemas** for:

   * Meshery
   * Layer5 Cloud
   * Combined (all constructs)
2. **Generates:**

   * Golang structs
   * TypeScript types
   * JSON & YAML templates
   * RTK Query clients

> ‚ö†Ô∏è This is the recommended way to stay in sync with schema changes.

---

## üß± Bundled Schema Outputs

After running `make build`, three bundled schema files are created:

| File                 | Purpose                                        |
| -------------------- | ---------------------------------------------- |
| `merged_schema.yml`  | All schemas combined (used by Meshery clients) |
| `cloud_schema.yml`   | Cloud-specific APIs for Layer5 Cloud           |
| `meshery_schema.yml` | Meshery-specific APIs                          |

---

## ‚úçÔ∏è Annotating OpenAPI Paths

To control which schema paths are included in each bundled output, use the `x-internal` annotation inside the OpenAPI operations (`get`, `post`, etc.).

### Example:

```yaml
paths:
  /api/entitlement/plans:
    get:
      x-internal: ["cloud"]
      operationId: getPlans
      tags:
        - Plans
      summary: Get all plans supported by the system
      responses:
        "200":
          description: Plans fetched successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Plan"
```

* **With `x-internal`**: Included only in the respective client (e.g., `cloud`).
* **Without `x-internal`**: Included in **all** clients.

---

## üõ†Ô∏è Advanced Usage (Optional)

### üìå Custom Generation in `generate.sh`

Meshery uses a helper script (`generate.sh`) to map schema constructs to generated output:

```bash
generate_schema_models <construct> <schema-version> [<openapi-file>]

generate_schema_models "capability" "v1alpha1"
generate_schema_models "category" "v1beta1"
generate_schema_models "pattern" "v1beta1" "schemas/constructs/v1beta1/design/openapi.yml"
```

This maps to Go packages like:

```
models/v1alpha1/capability/capability.go
```

### üß© RTK Query Client Generation

The OpenAPI bundle is passed to a codegen tool to generate RTK Query clients. Include relevant paths using `x-internal` annotations and define request/response schemas appropriately.

You can control this in `generate.sh` like:

```bash
# Merge relevant constructs for RTK generation
npx @redocly/cli join schemas/base_cloud.yml \
     "${v1beta1}/pattern/${merged_construct}" \
     "${v1beta1}/component/${merged_construct}" \
     "${v1beta1}/model/${merged_construct}" \
     ... \
     -o schemas/merged_openapi.yml \
     --prefix-tags-with-info-prop title \
     --prefix-components-with-info-prop title
```

# Using Generated RTK Query Clients


## Prerequisites

Before using the generated RTK clients, ensure you have:

1. Installed the required dependencies:
   - `@reduxjs/toolkit`
   - `@layer5/schemas`

2. Set up environment variables:
   - `RTK_CLOUD_ENDPOINT_PREFIX`: Base URL for Cloud API endpoints
   - `RTK_MESHERY_ENDPOINT_PREFIX`: Base URL for Meshery API endpoints

## Store Configuration

### Import API Slices Correctly

To avoid cyclical imports that can break your application, import API slices from their specific exports:

```javascript
// ‚úÖ Correct: Import from specific API exports
import { cloudApi as cloudBaseApi } from "@layer5/schemas/dist/cloudApi";
import { mesheryApi } from "@layer5/schemas/dist/mesheryApi";

// ‚ùå Incorrect: Do not import directly from generic API file
// import { api } from "@layer5/schemas/dist/api"; // Can cause cyclical imports
```

### Configure Redux Store

Add the API reducers and middleware to your Redux store configuration:

```javascript
import { combineReducers, configureStore } from "@reduxjs/toolkit";
import { cloudApi as cloudBaseApi } from "@layer5/schemas/dist/cloudApi";
import catalogReducer from "./slices/catalog";
import connectionReducer from "./slices/connection";
import organizationReducer from "./slices/organization";
import chartReducer from "./slices/charts";
import themeReducer from "./slices/theme";
// Optional: If you have locally defined APIs
import { cloudApi } from "../api";

// Combine reducers
const rootReducer = combineReducers({
  catalog: catalogReducer,
  charts: chartReducer,
  organization: organizationReducer,
  connection: connectionReducer,
  theme: themeReducer,
  // Add generated API reducers
  [cloudBaseApi.reducerPath]: cloudBaseApi.reducer,
  // Optional: Add locally defined API reducers
  [cloudApi.reducerPath]: cloudApi.reducer
});

// Configure store with middleware
export const store = configureStore({
  reducer: reduxPersist.createPersistEnhancedReducer(rootReducer),
  middleware: getDefaultMiddleware =>
    getDefaultMiddleware()
      // Add generated API middleware
      .concat(cloudBaseApi.middleware)
      // Optional: Add locally defined API middleware
      .concat(cloudApi.middleware)
      // Add persistence middleware if needed
      .concat(reduxPersist.persistMiddleware)
});

// Set up listeners for RTK Query cache behaviors like refetchOnFocus/refetchOnReconnect
setupListeners(store.dispatch);
```

## Using API Hooks

After configuring your store, you can import and use the generated hooks:

### Cloud API Hooks

```javascript
import {
  useGetPlansQuery,
  useCreateDesignMutation,
  useGetDesignsQuery,
  // Other cloud API hooks...
} from "@layer5/schemas/dist/cloudApi";

function MyComponent() {
  // Use hooks directly in your components
  const { data: plans, isLoading, error } = useGetPlansQuery();

  // Handle loading states
  if (isLoading) return <div>Loading plans...</div>;

  // Handle errors
  if (error) return <div>Error loading plans</div>;

  // Use data
  return (
    <div>
      {plans.map(plan => (
        <div key={plan.id}>{plan.name}</div>
      ))}
    </div>
  );
}
```

### Meshery API Hooks

```javascript
import {
  useGetMeshModelsQuery,
  useSubmitMeshConfigMutation,
  // Other Meshery API hooks...
} from "@layer5/schemas/dist/mesheryApi";

function MesheryComponent() {
  const { data: meshModels } = useGetMeshModelsQuery();
  // ...
}
```

## Troubleshooting

### Common Issues

1. **Stuck Loading States**:
   - Verify environment variables are correctly set
   - Check for CORS issues
   - Ensure proper authentication headers are included

2. **Cyclical Imports**:
   - Always import from specific API files (`cloudApi.ts`, `mesheryApi.ts`)
   - Avoid importing from generic `api.ts` files

3. **Multiple RTK Instances**:
   - Ensure proper reducer and middleware registration
   - Check for naming conflicts in reducerPaths

### Redux DevTools

For better debugging, use Redux DevTools to monitor:
- API request lifecycles
- State changes
- Caching behavior

## Best Practices

1. **Handle Loading States**:
   ```javascript
   const { data, isLoading, isFetching, error } = useGetDataQuery();
   ```

2. **Leverage Cache Options**:
   ```javascript
   const { data } = useGetDataQuery(null, {
     pollingInterval: 30000, // Re-fetch every 30 seconds
     refetchOnMountOrArgChange: true,
     skip: !isReady // Skip query when not ready
   });
   ```

3. **Use Transformations When Needed**:
   ```javascript
   const transformedData = data?.map(item => ({
     ...item,
     formattedValue: formatValue(item.value)
   }));
   ```

## üß™ Testing & Validating Schemas

Validate your schema updates before committing by running:

```bash
make build
```

Or validate a single file:

```bash
npx @redocly/cli lint schemas/constructs/v1beta1/pattern/openapi.yml
```

---

## ‚úÖ Summary

| Task                    | Command                 |
| ----------------------- | ----------------------- |
| Generate everything     | `make build`            |
| Generate Go code only   | `make golang-generate`  |
| Generate TS + templates | `make generate-types`   |
| Lint OpenAPI            | `npx @redocly/cli lint` |

---

### License

This repository and site are available as open-source under the terms of the [Apache 2.0 License](https://opensource.org/licenses/Apache-2.0).

<p align="center" >
MESHERY IS A CLOUD NATIVE COMPUTING FOUNDATION PROJECT
</p>
